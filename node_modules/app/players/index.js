var weaponsModule = require('app/weapons');

function generateGUID() {
    function s4() {
        return Math.floor((1 + Math.random()) * 0x10000)
            .toString(16)
            .substring(1);
    }
    return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
        s4() + '-' + s4() + s4() + s4();
}

module.exports = {
    playersHash: {},
    isPlayersExists: function(name) {
        return !!this.playersHash[name];
    },
    tryAddPlayer: function(name, country, town) {
        if(this.isPlayersExists(name)) {
            return {
                success: false
            }
        }
        return {
            success: true,
            playerData: this.addPlayer(name, country, town)
        }
    },
    addPlayer: function(name, country, town) {
        var player = {
            name: name,
            key: generateGUID(),
            weaponList: weaponsModule.getWeaponList(),
            hp: 100,
            country: this.getCountry(country),
            town: town,
            lastRequestTime: Date.now()
        };
        this.playersHash[name] = player;
        return player;
    },
    deletePlayer: function(name) {
        delete players[name]
    },
    getCountry: function(country) {
        if(country === 'NoCountry') {
            return {
                demonym: 'NoCountry'
            }
        } else {
            return country;
        }
    }
};

